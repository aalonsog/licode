---
layout: default
title: Server API
serverapi: true
---

<!-- Subhead
================================================== -->
<header class="jumbotron subhead" id="overview">
  <div class="container">
    <h1>Server API</h1>
    <p class="lead">Server-side API, getting the resources needed for your videoconference application.</p>
  </div>
</header>


  <div class="container">

    <!-- Docs nav
    ================================================== -->
    <div class="row">
      <div class="span3 bs-docs-sidebar">
        <ul class="nav nav-list bs-docs-sidenav">
          <li><a href="#overview"><i class="icon-chevron-right"></i>Overview</a></li>
          <li><a href="#initialize"><i class="icon-chevron-right"></i>Initialize</a></li>
          <li><a href="#rooms"><i class="icon-chevron-right"></i>Rooms</a></li>
          <li><a href="#tokens"><i class="icon-chevron-right"></i>Tokens</a></li>
          <li><a href="#users"><i class="icon-chevron-right"></i>Users</a></li>
          <!--<li><a href="#serviceid"><i class="icon-chevron-right"></i>Get Service Id</a></li>-->
          <li><a href="#examples"><i class="icon-chevron-right"></i>Examples</a></li>
        </ul>
      </div>

      <div class="span9">

        <!-- Overview
        ================================================== -->
        <section id="overview">
          <div class="page-header">
            <h1>Overview</h1>
          </div>
          <p class="lead">The Licode server-side API provides your server communication with Nuve.</p>

          <p>Nuve is a Licode module that manages some resources like the videoconference rooms or the tokens to access to a determined room. Server-side API is available in node.js.</p>

          <table class="table table-bordered table-striped">
            <thead>
             <tr>
               <th style="width: 150px;">Class</th>
               <th>Description</th>
             </tr>
            </thead>
            <tbody>
             <tr>
               <td><a href="#rooms">Room</a></td>
               <td>Represents a videoconference room.</td>
             </tr>
             <tr>
               <td><a href="#tokens">Token</a></td>
               <td>The key to add a new participant to a videoconference room.</td>
             </tr>
             <tr>
               <td><a href="#users">User</a></td>
               <td>A user that can publish or subscribe to streams in a videoconference room.</td>
             </tr>
            </tbody>
          </table>

        </section>


        <!-- Initialize
        ================================================== -->
        <section id="initialize">
          <div class="page-header">
            <h1>Initialize</h1>
          </div>
          <p>Once you compile the API, you need to require it in your node.js server and initialize it with a Service. Call the constructor with the Service Id and the Service Key created in the data base. </p>
          <pre class="prettyprint linenums">
var N = require('./nuve');
N.API.init(serviceId, serviceKey, nuve_host);</pre>
          <p>With a Service you can create videoconference rooms for your videoconference application and get the neccesary tokens for add participants to them. Also you can ask Nuve about the users connected to a room.</p>
          <p>You can also compile Nuve API for python.</p>
        </section>


        <!-- Rooms
        ================================================== -->
        <section id="rooms">
          <div class="page-header">
            <h1>Rooms</h1>
          </div>
          <p class="lead">A Room object represent a videoconference room. In a room participate users that can interchange their streams. Each participant can publish his stream and/or subscribe to the other streams published in the room.</p>

          <p>A Room object has the following properties:</p>
          <ul>
            <li><code>Room.name</code>: the name of the room.</li>
            <li><code>Room._id</code>: a unique identifier for the room.</li>
            <li><code>Room.p2p</code> (optional): boolean that indicates if the room is a peer - to - peer room. In p2p rooms server side is only used for signalling.</li>
            <li><code>Room.data</code> (optional): additional metadata for the room.</li>
          </ul>
          <p>In your service you can create a room, get a list of rooms that you have created, get the info about a determined room or delete a room when you don't need it.</p>

          <p>In all functions you can include an optional error callback ir order to catch possible problems with nuve server.</p>

          <h3>Create Room</h3>
          <p>To create a room you need to specify a name and a callback function. When the room is created Nuve calls this function and returns you the roomId:</p>
          <pre class="prettyprint linenums">
var roomName = 'myFirstRoom';

N.API.createRoom(roomName, function(room) {
  console.log('Room created with id: ', room._id);
}, errorCallback);</pre>

<p>You can create peer - to - peer rooms in which users will communicate directly between their browsers using server side only for signalling.</p>
          <pre class="prettyprint linenums">
var roomName = 'myP2PRoom';

N.API.createRoom(roomName, function(room) {
  console.log('P2P room created with id: ', room._id);
}, errorCallback, {p2p: true});</pre>

<p>You can include metadata when creating the room. This metadata will be stored in <code>Room.data</code> field of the room.</p>
          <pre class="prettyprint linenums">
var roomName = 'myRoomWithMetadata';

N.API.createRoom(roomName, function(room) {
  console.log('P2P room created with id: ', room._id);
}, errorCallback, {data: {room_color: 'red', room_description: 'Room for testing metadata'}});</pre>

          <h3>Get Rooms</h3>
          <p>You can ask Nuve for a list of the rooms in your service:</p>
          <pre class="prettyprint linenums">
N.API.getRooms(function(roomList) {
  var rooms = JSON.parse(roomList);
  for(var i in rooms) {
    console.log('Room ', i, ':', rooms[i].name);
  }
}, errorCallback);</pre>

          <h3>Get Room</h3>
          <p>Also you can get the info about a determined room with its roomId:</p>
          <pre class="prettyprint linenums">
var roomId = '30121g51113e74fff3115502';

N.API.getRoom(roomId, function(resp) {
  var room= JSON.parse(resp);
  console.log('Room name: ', room.name);
}, errorCallback);</pre>

          <h3>Delete Room</h3>
          <p>And finally, to delete a determined room:</p>
          <pre class="prettyprint linenums">
var roomId = '30121g51113e74fff3115502';

N.API.deleteRoom(roomId, function(result) {
  console.log('Result: ', result);
}, errorCallback);</pre>

        </section>



        <!-- Tokens
        ================================================== -->
        <section id="tokens">
          <div class="page-header">
            <h1>Tokens</h1>
          </div>
          <p class="lead">A Token is a string that allows you to add a new participant to a determined room.</p>

          <p>When you want to add a new participant to a room, you need to create a new token than you will consume in the <a href="./client-api.html">client-side API</a>. To create a token you need to specify a name and a role for the new participant.</p>

          <ul>
            <li><code>Name</code>: a name that identify the participant.</li>
            <li><code>Role</code>: indicates de permissions that the user will have in the room. To learn more about how to manage roles and permmisions you can visit this <a href="http://lynckia.com/licode/roles.html">post</a>.</li>
          </ul>

          <h3>Create Token</h3>
          <p></p>
          <pre class="prettyprint linenums">
var roomId = '30121g51113e74fff3115502';
var name = 'userName';
var role = '';

N.API.createToken(roomId, name, role, function(token) {
  console.log('Token created: ', token);
}, errorCallback);</pre>

        </section>



        <!-- Users
        ================================================== -->
        <section id="users">
          <div class="page-header">
            <h1>Users</h1>
          </div>

          <p class="lead">A User object represents a participant in a videoconference room.</p>

          <p>A User object has the following properties:</p>
          <ul>
            <li><code>User.name</code>: the name specified when you created the token.</li>
            <li><code>User.role</code>: the role specified when you created the token.</li>
          </ul>
          <p>You can ask Nuve for a list of the users connected to a determined room.</p>

          <h3>Get Users</h3>
          <p></p>
          <pre class="prettyprint linenums">
var roomId = '30121g51113e74fff3115502';

N.API.getUsers(roomId, function(users) {
  var usersList = JSON.parse(users);
  console.log('This room has ', usersList.length, 'users');

  for(var i in usersList) {
    console.log('User ', i, ':', usersList[i].name, 'with role: ', usersList[i].role);
  }
}, errorCallback);</pre>

        </section>



        <!-- ServiceId
        ================================================== -->
        <!--<section id="serviceid">
          <div class="page-header">
            <h1>Get Service Id</h1>
          </div>
          <p class="lead">Here you can obtain a Service in order to create your own videoconference rooms.</p>

          <p>Fill the following fields and we send you and email with your ServiceId and your ServiceKey:</p>

          <p>Name:</p>
          <input type="text" id="name" class="span3">
          <p>Email address:</p>
          <input type="text" id="email" class="span3">

          <p><a class="btn btn-large btn-primary" onclick="createService();">Get Service Id</a></p>
          <div id="servMsg"></div>


        </section>-->

                <!-- Examples
        ================================================== -->
        <section id="examples">
          <div class="page-header">
            <h1>Examples</h1>
          </div>
          <p class="lead">With a deep intro into the contents out of the way, we can focus putting Server API to use. To do that, we'll utilize a basic example that includes everything we mentioned in the previous section.</p>
          <p>Now, here's a look at a typical server application implemented in Node.js:</p>
          <div class="row-fluid">

            <div class="span8">
              <pre class="prettyprint linenums:1">
var N = require('nuve');
N.API.init("531b26113e74ee30500001", "myKey", "http://localhost:3000/");</pre>
            </div>

            <div class="span4">
              <p>We first initialize Nuve (Server API)</p>
            </div>
          </div>
          <div class="row-fluid">

            <div class="span8">
              <pre class="prettyprint linenums:3">
var express = require('express');
var app = express.createServer();

app.use(express.bodyParser());
app.configure(function () {
    app.use(express.logger());
    app.use(express.static(__dirname + '/public'));
});</pre>
            </div>
            <div class="span4">
              <p>We also include express support for our server. We prepare it to publish static HTML files in which we  will have JavaScript client applications that we will explain later.</p>
            </div>

          </div>
          <div class="row-fluid">

            <div class="span8">
              <pre class="prettyprint linenums:11">
app.post('/createRoom/', function(req, res){

    N.API.createRoom('myRoom', function(roomID) {
        res.send(roomID);
    }, function (e) {
        console.log('Error: ', e);
    });
});</pre>
            </div>
            <div class="span4">
              <p>Requests to <code>/createRoom/</code> URL will create a new Room in Licode.</p>
            </div>

          </div>
          <div class="row-fluid">

            <div class="span8">
              <pre class="prettyprint linenums:18">
app.get('/getRooms/', function(req, res){

    N.API.getRooms(function(rooms) {
        res.send(rooms);
    }, function (e) {
        console.log('Error: ', e);
    });
});</pre>
            </div>
            <div class="span4">
              <p>Requests to <code>/getRooms/</code> URL will retrieve a list of our Rooms in Licode.</p>
            </div>

          </div>
          <div class="row-fluid">

            <div class="span8">
              <pre class="prettyprint linenums:24">
app.get('/getUsers/:room', function(req, res){

    var room = req.params.room;
    N.API.getUsers(room, function(users) {
        res.send(users);
    }, function (e) {
        console.log('Error: ', e);
    });
});</pre>
            </div>
            <div class="span4">
              <p>Requests to <code>/getUsers/roomID</code> URL will retrieve a list of users that are connected to room <code>roomID</code>.</p>
            </div>

          </div>
          <div class="row-fluid">

            <div class="span8">
              <pre class="prettyprint linenums:31">
app.post('/createToken/:room', function(req, res){

    var room = req.params.room;
    var username = req.body.username;
    var role = req.body.role;
    N.API.createToken(room, username, role, function(token) {
        res.send(token);
    }, function (e) {
        console.log('Error: ', e);
    });
});</pre>
            </div>
            <div class="span4">
              <p>Requests to <code>/createToken/roomID</code> URL will create an access token for including a participant in room <code>roomID</code>.</p>
            </div>

          </div>
          <div class="row-fluid">

            <div class="span8">
              <pre class="prettyprint linenums:40">
app.listen (80);</pre>
            </div>
            <div class="span4">
              <p>Finally, we will start our service, that will listen to port 80 (line 19).</p>
            </div>
          </div>

        </section>

        <!-- Next
        ================================================== -->
        <section id="what-next">
          <div class="page-header">
            <h1>What next?</h1>
          </div>
          <p class="lead">Head to the Client API for information, examples, and code snippets of the additional API to handle connections to rooms and streams in your web applications, or start testing this API.</p>
          <a class="btn btn-large btn-primary" href="./client-api.html">Visit the Client API</a>
          <a class="btn btn-large" href="http://chotis2.dit.upm.es" style="margin-left: 5px;">Try it!</a>
        </section>

      </div>
    </div>

  </div>
